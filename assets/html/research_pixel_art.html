<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ACSL Research - Robot AI for Home Service</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#1a1a2e;display:flex;justify-content:center;align-items:center;min-height:100vh}
canvas{width:100%;max-width:800px;image-rendering:pixelated;image-rendering:crisp-edges;-ms-interpolation-mode:nearest-neighbor}
</style>
</head>
<body>
<canvas id="c" width="400" height="210"></canvas>
<script>
(function(){
'use strict';
var cv=document.getElementById('c'),cx=cv.getContext('2d');
var W=400,H=210,P=2,AW=W/P,AH=H/P;
var FPS=10,TOTAL=210,frame=0;

/* ── colour palette ── */
var C={
  wL:'#FFF0DB',wL2:'#FFE4C4',wH:'#F5E6D0',wH2:'#EDD9C4',wK:'#E8F4FC',wK2:'#D6EAF5',
  fl:'#C49A6C',flD:'#B08050',flL:'#D4AA7C',base:'#8B7355',
  ceil:'#FFF8F0',
  rBody:'#4FC3F7',rBodyD:'#29B6F6',rHead:'#81D4FA',rEye:'#FFF',rPup:'#1A237E',
  rAcc:'#FFD54F',rAccD:'#FFC107',rWh:'#455A64',rAnt:'#FF7043',rAntB:'#FFAB91',
  skin:'#FFCC80',skinD:'#FFB74D',hair:'#5D4037',hairL:'#795548',
  shirt:'#FF7043',shirtD:'#E64A19',pants:'#5C6BC0',shoe:'#37474F',
  couch:'#26A69A',couchD:'#00897B',couchL:'#4DB6AC',
  tbl:'#8D6E63',tblD:'#6D4C41',
  ctr:'#ECEFF1',ctrD:'#CFD8DC',cab:'#A1887F',cabD:'#795548',
  cmach:'#455A64',cmachL:'#607D8B',cmachAcc:'#EF5350',
  plantG:'#66BB6A',plantD:'#43A047',plantL:'#81C784',pot:'#A1887F',potD:'#795548',
  winF:'#FFFFFF',winG:'#BBDEFB',winGl:'#E3F2FD',curt:'#FFAB91',curtD:'#FF8A65',
  picF:'#8D6E63',
  coffee:'#6D4C41',cup:'#FFFFFF',cupD:'#ECEFF1',steam:'#B0BEC5',
  heart:'#FF5252',star:'#FFD54F',
  bubBg:'#FFFFFF',bubBd:'#B0BEC5',txt:'#37474F',
  hInt:'#AB47BC',hNav:'#009688',hPer:'#42A5F5',hMan:'#FF7043',hDef:'#546E7A',
  white:'#FFF',black:'#000',
  door:'#8D6E63',doorD:'#6D4C41',doorK:'#FFD54F',
  rug:'#E8D5B7',rugD:'#D4C4A8',rugP:'#FFAB91',
  fridge:'#ECEFF1',fridgeD:'#CFD8DC',
  lamp:'#FFD54F',lampD:'#FFC107',lampW:'#FFF8E1',
  tile:'#E0E0E0',tileD:'#BDBDBD'
};

/* ── helpers ── */
function px(x,y,c){cx.fillStyle=c;cx.fillRect(x*P,y*P,P,P)}
function rect(x,y,w,h,c){cx.fillStyle=c;cx.fillRect(x*P,y*P,w*P,h*P)}
function lerp(a,b,t){return a+(b-a)*Math.max(0,Math.min(1,t))}
function smoothstep(t){t=Math.max(0,Math.min(1,t));return t*t*(3-2*t)}

/* ── state functions (all pure functions of frame) ── */
function getRobotX(f){
  if(f<=12) return lerp(20,88,f/12);
  if(f<=58) return 88;
  if(f<=64) return lerp(88,135,smoothstep((f-58)/6));
  if(f<=100) return lerp(135,495,smoothstep((f-64)/36));
  if(f<=112) return lerp(495,505,(f-100)/12);
  if(f<=140) return 505;
  if(f<=147) return lerp(505,495,(f-140)/7);
  if(f<=180) return lerp(495,135,smoothstep((f-147)/33));
  if(f<=190) return lerp(135,112,smoothstep((f-180)/10));
  return 112;
}
function getCamX(f){return Math.max(0,Math.min(getRobotX(f)-100,400))}

function getRobotFacing(f){
  if(f<=112) return 'right';
  if(f<=147) return 'left';
  if(f<=178) return 'left';
  return 'right';
}
function getRobotArm(f){
  if(f<=58) return 'idle';
  if(f<=100) return 'walk';
  if(f<=112) return 'walk';
  if(f<=122) return 'extend';
  if(f<=130) return 'idle';
  if(f<=192) return 'carry';
  if(f<=199) return 'give';
  return 'idle';
}
function getHumanState(f){
  if(f>=193&&f<=199) return 'receive';
  if(f>=200) return 'hold';
  return 'idle';
}

/* ── backgrounds ── */
function drawFloorWood(ox,y0,w){
  rect(ox,y0,w,30,C.fl);
  for(var x=0;x<w;x+=14){rect(ox+x,y0,1,30,C.flD)}
  for(var y=0;y<30;y+=7){
    rect(ox,y0+y,w,1,C.flL);
    for(var x2=y%14;x2<w;x2+=14){px(ox+x2,y0+y,C.flD)}
  }
}
function drawFloorTile(ox,y0,w){
  rect(ox,y0,w,30,C.tile);
  for(var x=0;x<w;x+=8){rect(ox+x,y0,1,30,C.tileD)}
  for(var y=0;y<30;y+=8){rect(ox,y0+y,w,1,C.tileD)}
}

function drawWindow(ox,x,y){
  var wx=ox+x;
  rect(wx-3,y-2,44,3,C.curtD);
  rect(wx-3,y+1,7,34,C.curt); rect(wx+34,y+1,7,34,C.curt);
  rect(wx,y,38,32,C.winF);
  rect(wx+2,y+2,16,13,C.winGl); rect(wx+20,y+2,16,13,C.winG);
  rect(wx+2,y+17,16,13,C.winG); rect(wx+20,y+17,16,13,C.winGl);
  rect(wx,y+15,38,2,C.winF); rect(wx+18,y+2,2,28,C.winF);
}
function drawPlant(ox,x,y){
  var px2=ox+x;
  rect(px2,y+10,8,6,C.potD); rect(px2+1,y+10,6,5,C.pot);
  rect(px2+1,y+8,6,3,C.plantG);
  rect(px2+2,y+5,4,4,C.plantG);
  rect(px2+3,y+2,2,4,C.plantD);
  px(px2,y+7,C.plantL); px(px2+6,y+6,C.plantL);
  px(px2+1,y+4,C.plantL); px(px2+5,y+3,C.plantL);
  rect(px2+3,y,2,3,C.plantD);
  px(px2+1,y+1,C.plantG); px(px2+5,y+1,C.plantG);
}
function drawCouch(ox,x,y){
  var cx2=ox+x;
  rect(cx2-3,y,3,24,C.couchD);
  rect(cx2+56,y,3,24,C.couchD);
  rect(cx2,y,56,6,C.couchD);
  rect(cx2,y+6,56,10,C.couch);
  rect(cx2+2,y+7,52,8,C.couchL);
  rect(cx2+2,y+8,17,6,C.couch); rect(cx2+21,y+8,15,6,C.couch); rect(cx2+38,y+8,16,6,C.couch);
  rect(cx2,y+16,56,5,C.couchD);
  rect(cx2+3,y+21,4,3,C.tblD); rect(cx2+49,y+21,4,3,C.tblD);
}
function drawTable(ox,x,y){
  var tx=ox+x;
  rect(tx,y,24,3,C.tbl);
  rect(tx+1,y+1,22,1,C.tblD);
  rect(tx+2,y+3,3,9,C.tblD); rect(tx+19,y+3,3,9,C.tblD);
}
function drawBookshelf(ox,x,y){
  var bx=ox+x;
  rect(bx,y,22,44,C.tblD);
  rect(bx+1,y+1,20,9,C.tbl);
  rect(bx+1,y+12,20,9,C.tbl);
  rect(bx+1,y+23,20,9,C.tbl);
  rect(bx+1,y+34,20,9,C.tbl);
  var cols=['#EF5350','#42A5F5','#66BB6A','#FFD54F','#AB47BC','#FF7043','#26A69A','#EC407A'];
  for(var shelf=0;shelf<4;shelf++){
    var sy=y+2+shelf*11;
    for(var b=0;b<5;b++){
      var bw=2+Math.floor(Math.abs(Math.sin(shelf*5+b*3))*2);
      rect(bx+2+b*4,sy,bw,7,cols[(shelf*5+b)%cols.length]);
    }
  }
}
function drawPicFrame(ox,x,y,w,h){
  var fx=ox+x;
  rect(fx,y,w,h,C.picF);
  rect(fx+1,y+1,w-2,h-2,'#E3F2FD');
  rect(fx+2,y+h-5,w-4,3,'#A5D6A7');
  px(fx+Math.floor(w/3),y+3,'#FFD54F');
}

function drawDoor(ox,x,y){
  var dx=ox+x;
  rect(dx,y-2,28,2,C.doorD);
  rect(dx,y,28,40,C.door);
  rect(dx+2,y+2,24,36,C.doorD);
  rect(dx+3,y+3,22,16,C.wH);
  rect(dx+3,y+21,22,16,C.wH);
  px(dx+22,y+20,C.doorK); px(dx+23,y+20,C.doorK);
}
function drawWallLamp(ox,x,y){
  var lx=ox+x;
  rect(lx+2,y,4,3,C.cabD);
  rect(lx,y+3,8,2,C.lamp);
  rect(lx+1,y+3,6,1,C.lampD);
  rect(lx+1,y+5,6,3,C.lampW);
}

function drawCabinets(ox,x,y,w){
  var kx=ox+x;
  rect(kx,y,w,22,C.cab);
  for(var i=0;i<Math.floor(w/20);i++){
    rect(kx+2+i*20,y+2,16,18,C.cabD);
    rect(kx+3+i*20,y+3,14,16,C.cab);
    px(kx+10+i*20,y+11,C.doorK);
  }
}
function drawCounter(ox,x,y,w){
  var kx=ox+x;
  rect(kx,y,w,2,C.ctrD);
  rect(kx,y+2,w,14,C.ctr);
  for(var i=0;i<Math.floor(w/18);i++){
    rect(kx+2+i*18,y+4,14,10,C.ctrD);
    rect(kx+3+i*18,y+5,12,8,C.ctr);
    px(kx+9+i*18,y+9,C.cabD);
  }
}
function drawCoffeeMachine(ox,x,y){
  var mx=ox+x;
  rect(mx,y,20,16,C.cmach);
  rect(mx+1,y+1,18,6,C.cmachL);
  rect(mx+3,y+2,5,4,'#263238');
  rect(mx+10,y+2,6,4,'#37474F');
  px(mx+17,y+2,C.cmachAcc);
  rect(mx+2,y+8,16,2,C.cmachL);
  rect(mx+6,y+10,8,5,C.cmach);
  rect(mx+7,y+11,6,4,'#263238');
}
function drawFridge(ox,x,y){
  var fx=ox+x;
  rect(fx,y,20,48,C.fridge);
  rect(fx+1,y+1,18,22,C.fridgeD);
  rect(fx+1,y+25,18,22,C.fridgeD);
  rect(fx+2,y+2,16,20,C.fridge);
  rect(fx+2,y+26,16,20,C.fridge);
  rect(fx+15,y+10,2,6,C.cabD);
  rect(fx+15,y+34,2,6,C.cabD);
}
function drawRunnerRug(ox,x,y,w){
  var rx=ox+x;
  rect(rx,y,w,6,C.rug);
  rect(rx+2,y+1,w-4,4,C.rugD);
  for(var i=0;i<w;i+=6){px(rx+i+3,y+2,C.rugP);px(rx+i+3,y+3,C.rugP)}
}

/* ── draw rooms ── */
function drawRoom_Living(ox){
  rect(ox,0,200,57,C.wL);
  for(var y=4;y<57;y+=12){rect(ox,y,200,1,C.wL2)}
  rect(ox,55,200,2,C.base);
  drawFloorWood(ox,57,200);
  drawWindow(ox,12,10);
  drawPicFrame(ox,68,14,18,14);
  drawPlant(ox,55,42);
  drawTable(ox,80,62);
  drawCouch(ox,110,52);
  drawBookshelf(ox,172,12);
  drawRunnerRug(ox,60,72,115);
}
function drawRoom_Hall(ox){
  rect(ox,0,200,57,C.wH);
  for(var y=4;y<57;y+=12){rect(ox,y,200,1,C.wH2)}
  rect(ox,55,200,2,C.base);
  drawFloorWood(ox,57,200);
  drawDoor(ox,25,14);
  drawPicFrame(ox,75,16,16,12);
  drawWallLamp(ox,110,12);
  drawPicFrame(ox,130,18,14,10);
  drawDoor(ox,155,14);
  drawRunnerRug(ox,15,68,170);
}
function drawRoom_Kitchen(ox){
  rect(ox,0,200,57,C.wK);
  for(var y=4;y<57;y+=12){rect(ox,y,200,1,C.wK2)}
  rect(ox,55,200,2,C.base);
  drawFloorTile(ox,57,200);
  drawCabinets(ox,30,6,100);
  drawCounter(ox,30,40,100);
  drawCoffeeMachine(ox,80,28);
  drawFridge(ox,155,8);
  drawWallLamp(ox,60,0);
}

function drawDoorframe(ox,x){
  var dx=ox+x;
  rect(dx,0,6,57,C.doorD);
  rect(dx+1,0,4,57,C.door);
}

function drawBackground(camX,f){
  cx.fillStyle=C.black;cx.fillRect(0,0,W,H);
  var ox0=0-camX, ox1=200-camX, ox2=400-camX;
  if(ox0+200>0&&ox0<200) drawRoom_Living(ox0);
  if(ox1+200>0&&ox1<200) drawRoom_Hall(ox1);
  if(ox2+200>0&&ox2<200) drawRoom_Kitchen(ox2);
  if(ox1>0&&ox1<200) drawDoorframe(0,ox1-3);
  if(ox2>0&&ox2<200) drawDoorframe(0,ox2-3);
}

/* ── robot ── */
function drawRobot(sx,by,facing,arm,f){
  if(sx<-15||sx>215) return;
  var dir=facing==='right'?1:-1;
  var walking=(arm==='walk');
  var moving=walking||((arm==='carry')&&(f>=141&&f<=190));
  var bob=moving?Math.round(Math.sin(f*0.8)):0;
  var ay=by+bob;
  var wRot=f%4;

  rect(sx-4,by-2,3,3,C.rWh);
  rect(sx+2,by-2,3,3,C.rWh);
  if(moving){
    px(sx-3+wRot%2,by-1,C.rAcc);
    px(sx+3-wRot%2,by-1,C.rAcc);
  }

  rect(sx-4,ay-10,9,8,C.rBody);
  rect(sx-3,ay-9,7,6,C.rBodyD);
  rect(sx-2,ay-8,5,3,C.rAcc);
  px(sx-1,ay-7,C.rAccD); px(sx+1,ay-7,C.rAccD);

  rect(sx-5,ay-17,11,7,C.rHead);
  rect(sx-4,ay-18,9,1,C.rHead);
  var ex=dir>0?1:0;
  rect(sx-3+ex,ay-15,2,3,C.rEye);
  rect(sx+1+ex,ay-15,2,3,C.rEye);
  px(sx-2+ex+(dir>0?1:0),ay-14,C.rPup);
  px(sx+2+ex+(dir>0?1:0),ay-14,C.rPup);

  if(f%20<10){rect(sx-1,ay-12,3,1,'#E0E0E0')}
  else{px(sx-1,ay-12,'#E0E0E0');px(sx+1,ay-12,'#E0E0E0');px(sx,ay-13,'#E0E0E0')}

  px(sx,ay-19,C.rBodyD); px(sx,ay-20,C.rBodyD);
  px(sx,ay-21,f%8<4?C.rAnt:C.rAntB);

  if(arm==='idle'){
    rect(sx-6,ay-9,2,5,C.rBody);
    rect(sx+5,ay-9,2,5,C.rBody);
  } else if(arm==='walk'){
    var sw=Math.round(Math.sin(f*0.8)*2);
    rect(sx-6,ay-9+sw,2,5,C.rBody);
    rect(sx+5,ay-9-sw,2,5,C.rBody);
  } else if(arm==='extend'){
    rect(sx-6,ay-9,2,5,C.rBody);
    rect(sx+(dir>0?5:-8),ay-10,4,2,C.rBody);
    rect(sx+(dir>0?8:-11),ay-11,3,2,C.rAcc);
  } else if(arm==='carry'){
    rect(sx-6,ay-11,2,5,C.rBody);
    rect(sx+5,ay-11,2,5,C.rBody);
    var trayX=dir>0?sx+6:sx-10;
    rect(trayX,ay-13,6,1,C.tbl);
    rect(trayX+1,ay-16,4,3,C.cup);
    rect(trayX+2,ay-15,2,1,C.coffee);
    if(f%6<3){px(trayX+2,ay-17,C.steam);px(trayX+3,ay-18,C.steam)}
    else{px(trayX+3,ay-17,C.steam);px(trayX+2,ay-18,C.steam)}
  } else if(arm==='give'){
    rect(sx-6,ay-9,2,5,C.rBody);
    var gx=dir>0?5:-10;
    rect(sx+gx,ay-12,4,2,C.rBody);
    rect(sx+gx+(dir>0?3:-3),ay-14,5,1,C.tbl);
    rect(sx+gx+(dir>0?4:-2),ay-17,4,3,C.cup);
    rect(sx+gx+(dir>0?5:-1),ay-16,2,1,C.coffee);
  }
}

/* ── human ── */
function drawHuman(sx,seatY,state,f){
  if(sx<-15||sx>215) return;
  var hy=seatY;
  rect(sx-3,hy-20,7,5,C.hair);
  rect(sx-4,hy-18,9,3,C.hair);
  px(sx-4,hy-20,C.hairL); px(sx+3,hy-20,C.hairL);

  rect(sx-3,hy-15,7,6,C.skin);
  px(sx-1,hy-13,C.txt); px(sx+2,hy-13,C.txt);
  if(state==='hold'){
    px(sx-1,hy-11,C.txt);px(sx+2,hy-11,C.txt);px(sx,hy-10,C.txt);
  } else {
    rect(sx-1,hy-10,4,1,C.skinD);
  }

  rect(sx-4,hy-9,9,8,C.shirt);
  rect(sx-3,hy-8,7,6,C.shirtD);

  rect(sx-4,hy-1,9,4,C.pants);
  rect(sx-4,hy+3,4,4,C.pants); rect(sx+1,hy+3,4,4,C.pants);
  px(sx-4,hy+7,C.shoe); px(sx-3,hy+7,C.shoe);
  px(sx+3,hy+7,C.shoe); px(sx+4,hy+7,C.shoe);

  if(state==='idle'){
    rect(sx+5,hy-7,2,5,C.skin);
    rect(sx-6,hy-7,2,5,C.skin);
  } else if(state==='receive'){
    rect(sx+5,hy-7,2,5,C.skin);
    rect(sx-7,hy-10,2,4,C.skin);
    rect(sx-9,hy-11,2,2,C.skin);
  } else if(state==='hold'){
    rect(sx+5,hy-7,2,5,C.skin);
    rect(sx-7,hy-8,2,4,C.skin);
    rect(sx-10,hy-11,4,3,C.cup);
    rect(sx-9,hy-10,2,1,C.coffee);
    if(f%6<3){px(sx-9,hy-12,C.steam);px(sx-8,hy-13,C.steam)}
    else{px(sx-8,hy-12,C.steam);px(sx-9,hy-13,C.steam)}
  }
}

/* ── speech bubbles ── */
function drawBubble(sx,sy,text,progress,pointer){
  var vis=text.substring(0,Math.ceil(progress));
  if(!vis) return;
  cx.font='bold 9px "Courier New",monospace';
  var tw=cx.measureText(vis).width/P;
  var bw=Math.max(tw+6,14), bh=8;
  var bx=Math.round(sx-bw/2), by=sy-bh;

  rect(bx-1,by-1,bw+2,bh+2,C.bubBd);
  rect(bx,by,bw,bh,C.bubBg);

  if(pointer==='down'){
    rect(sx-1,sy+1,3,2,C.bubBd);
    rect(sx,sy+1,1,1,C.bubBg);
  }

  cx.fillStyle=C.txt;
  cx.font='bold 9px "Courier New",monospace';
  cx.textAlign='center';
  cx.textBaseline='middle';
  cx.fillText(vis,sx*P,(by+bh/2)*P);
}

function drawSpeechBubbles(f,camX){
  var robotSX=getRobotX(f)-camX;
  var humanSX=142-camX;
  if(f>=14&&f<28){
    drawBubble(robotSX,56-21,'Hey! Need anything?',Math.min((f-14)*1.8,19),'down');
  }
  if(f>=29&&f<44){
    drawBubble(humanSX,52-22,'Can I get a coffee?',Math.min((f-29)*1.8,19),'down');
  }
  if(f>=45&&f<58){
    drawBubble(robotSX,56-21,'Say less!',Math.min((f-45)*2,9),'down');
  }
  if(f>=186&&f<198){
    drawBubble(robotSX,56-21,'Here you go!',Math.min((f-186)*2,12),'down');
  }
}

/* ── effects ── */
function drawHeart(x,y,s){
  var sc=Math.max(0.5,s);
  px(x-1,y,C.heart);px(x+1,y,C.heart);
  if(sc>0.7){px(x-2,y+1,C.heart);px(x-1,y+1,C.heart);px(x,y+1,C.heart);px(x+1,y+1,C.heart);px(x+2,y+1,C.heart)}
  px(x-1,y+2,C.heart);px(x,y+2,C.heart);px(x+1,y+2,C.heart);
  px(x,y+3,C.heart);
}
function drawStar(x,y,c){
  px(x,y-1,c);px(x-1,y,c);px(x,y,c);px(x+1,y,c);px(x,y+1,c);
}

function drawEffects(f,camX){
  if(f>=113&&f<=132){
    var machSX=480-camX;
    if(f>=113&&f<=130) px(machSX+17,30,'#4CAF50');
    if(f>=115&&f<=128){
      if(f%3===0) px(machSX+10,27,C.steam);
      if(f%3===1) px(machSX+11,26,C.steam);
    }
    if(f>=118&&f<=130){
      var cupSX=machSX+22;
      rect(cupSX,38,4,3,C.cup);
      rect(cupSX,39,4,1,C.cupD);
      var fillH=Math.min(Math.floor((f-118)/3)+1,2);
      rect(cupSX,39+(2-fillH),4,fillH,C.coffee);
      if(f>=123&&f%4<2){px(cupSX+1,37,C.steam);px(cupSX+2,36,C.steam)}
    }
  }
  if(f>=198&&f<=209){
    var hx=142-camX;
    var t=f-198;
    drawHeart(hx-6,38-t*1.1,1-t/14);
    drawHeart(hx+6,40-t*0.9,1-t/14);
    drawHeart(hx,36-t*1.3,1-t/14);
    if(t>2){drawStar(hx-9,42-t*0.5,C.star);drawStar(hx+9,41-t*0.7,C.star)}
  }
}

/* ── HUD bar ── */
function getHUDInfo(f){
  if(f<13) return {label:'ROBOT AI FOR HOME SERVICE',color:C.hDef};
  if(f<60) return {label:'INTELLIGENT INTERACTION',color:C.hInt};
  if(f<100) return {label:'GENERAL-PURPOSE NAVIGATION',color:C.hNav};
  if(f<113) return {label:'MULTI-MODAL PERCEPTION',color:C.hPer};
  if(f<145) return {label:'MOBILE MANIPULATION',color:C.hMan};
  if(f<180) return {label:'GENERAL-PURPOSE NAVIGATION',color:C.hNav};
  if(f<200) return {label:'INTELLIGENT INTERACTION',color:C.hInt};
  return {label:'INTELLIGENT INTERACTION',color:C.hInt};
}

function drawHUD(f){
  var info=getHUDInfo(f);
  rect(0,88,200,17,info.color);
  rect(0,88,200,1,'rgba(255,255,255,0.15)');
  rect(1,89,198,1,'rgba(0,0,0,0.1)');

  var dotX=8,dotY=96;
  if(info.color===C.hInt){
    rect(dotX,dotY-3,5,4,C.white);rect(dotX+1,dotY+1,3,2,C.white);px(dotX,dotY+1,C.white);
  } else if(info.color===C.hNav){
    rect(dotX,dotY-2,3,1,C.white);rect(dotX,dotY-1,5,1,C.white);rect(dotX,dotY,3,1,C.white);
    px(dotX+4,dotY-3,C.white);px(dotX+4,dotY+1,C.white);
  } else if(info.color===C.hPer){
    rect(dotX+1,dotY-2,3,1,C.white);rect(dotX,dotY-1,5,3,C.white);rect(dotX+1,dotY+2,3,1,C.white);
    px(dotX+2,dotY,C.rPup);
  } else if(info.color===C.hMan){
    rect(dotX,dotY-2,2,4,C.white);rect(dotX+2,dotY-3,3,2,C.white);rect(dotX+4,dotY-1,1,3,C.white);
  } else {
    px(dotX+2,dotY-2,C.star);px(dotX+1,dotY-1,C.star);px(dotX+2,dotY-1,C.star);px(dotX+3,dotY-1,C.star);px(dotX+2,dotY,C.star);
  }

  cx.fillStyle=C.white;
  cx.font='bold 9px "Courier New",monospace';
  cx.textAlign='left';
  cx.textBaseline='middle';
  cx.fillText(info.label,30,96*P);
}

/* ── main draw ── */
function draw(){
  var f=frame;
  var robotX=getRobotX(f);
  var camX2=getCamX(f);
  var facing=getRobotFacing(f);
  var arm=getRobotArm(f);
  var hState=getHumanState(f);

  cx.fillStyle=C.black;
  cx.fillRect(0,0,W,H);

  drawBackground(Math.round(camX2),f);

  var humanSX=Math.round(142-camX2);
  if(humanSX>-20&&humanSX<220){
    drawHuman(humanSX,66,hState,f);
  }

  var robotSX=Math.round(robotX-camX2);
  drawRobot(robotSX,80,facing,arm,f);

  drawSpeechBubbles(f,Math.round(camX2));
  drawEffects(f,Math.round(camX2));
  drawHUD(f);

  if(f>=207){
    var alpha=Math.min((f-207)/3,1);
    cx.fillStyle='rgba(0,0,0,'+alpha+')';
    cx.fillRect(0,0,W,88*P);
  }
}

/* ── loop ── */
var last=0;
function loop(ts){
  requestAnimationFrame(loop);
  if(!last)last=ts;
  if(ts-last>=1000/FPS){
    last=ts-(ts-last)%Math.floor(1000/FPS);
    draw();
    frame=(frame+1)%TOTAL;
  }
}
requestAnimationFrame(loop);
})();
</script>
</body>
</html>
